name: Label Management

on:
  workflow_dispatch:
  schedule:
    # Roda toda segunda-feira √†s 9h (UTC)
    - cron: '0 9 * * 1'

jobs:
  create-labels:
    name: Create and Update Repository Labels
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Create/Update Labels
        uses: actions/github-script@v7
        with:
          script: |
            const labels = [
              // Tipos
              { name: 'feature', color: '0e8a16', description: 'Nova funcionalidade' },
              { name: 'bug', color: 'd73a4a', description: 'Comportamento incorreto' },
              { name: 'enhancement', color: 'a2eeef', description: 'Melhoria de funcionalidade existente' },
              { name: 'technical', color: '1d76db', description: 'Tarefa t√©cnica ou refatora√ß√£o' },
              { name: 'documentation', color: '0075ca', description: 'Documenta√ß√£o' },
              { name: 'testing', color: '7057ff', description: 'Testes automatizados' },
              { name: 'refactoring', color: '5319e7', description: 'Refatora√ß√£o de c√≥digo' },
              
              // Prioridades
              { name: 'P0-critical', color: 'b60205', description: 'Prioridade 0 - Cr√≠tica (bloqueante)' },
              { name: 'P1-high', color: 'ff9800', description: 'Prioridade 1 - Alta (importante)' },
              { name: 'P2-medium', color: 'ffc107', description: 'Prioridade 2 - M√©dia (desej√°vel)' },
              { name: 'P3-low', color: '4caf50', description: 'Prioridade 3 - Baixa (pode aguardar)' },
              
              // Status
              { name: 'needs-triage', color: 'fbca04', description: 'Aguardando triagem' },
              { name: 'ready', color: '0e8a16', description: 'Pronta para desenvolvimento' },
              { name: 'in-progress', color: '1d76db', description: 'Em desenvolvimento' },
              { name: 'in-review', color: '5319e7', description: 'Em code review' },
              { name: 'blocked', color: 'd93f0b', description: 'Bloqueada por depend√™ncia' },
              { name: 'done', color: '0e8a16', description: 'Conclu√≠da' },
              
              // M√≥dulos
              { name: 'auth', color: 'c5def5', description: 'M√≥dulo: Autentica√ß√£o' },
              { name: 'fornecedores', color: 'c5def5', description: 'M√≥dulo: Fornecedores' },
              { name: 'editais', color: 'c5def5', description: 'M√≥dulo: Editais' },
              { name: 'lotes', color: 'c5def5', description: 'M√≥dulo: Lotes' },
              { name: 'demandas', color: 'c5def5', description: 'M√≥dulo: Demandas/Procurement' },
              { name: 'secretarias', color: 'c5def5', description: 'M√≥dulo: Multi-tenant Secretarias' },
              { name: 'oauth', color: 'c5def5', description: 'M√≥dulo: OAuth Authentication' },
              { name: 'auditoria', color: 'c5def5', description: 'M√≥dulo: Auditoria' },
              { name: 'infra', color: 'c5def5', description: 'M√≥dulo: Infraestrutura' },
              { name: 'database', color: 'c5def5', description: 'M√≥dulo: Database' },
              
              // Especiais
              { name: 'good-first-issue', color: '7057ff', description: 'Boa para iniciantes' },
              { name: 'help-wanted', color: '008672', description: 'Precisa de ajuda' },
              { name: 'breaking-change', color: 'd73a4a', description: 'Quebra compatibilidade' },
              { name: 'security', color: 'b60205', description: 'Quest√£o de seguran√ßa' },
              { name: 'performance', color: 'ff9800', description: 'Performance' },
              { name: 'quality', color: '0075ca', description: 'Qualidade de c√≥digo' },
              { name: 'dependencies', color: '0366d6', description: 'Atualiza√ß√£o de depend√™ncias' },
              { name: 'duplicate', color: 'cfd3d7', description: 'Duplicada' },
              { name: 'wontfix', color: 'ffffff', description: 'N√£o ser√° implementado' },
              { name: 'invalid', color: 'e4e669', description: 'Inv√°lida' }
            ];
            
            for (const label of labels) {
              try {
                // Tenta criar a label
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`‚úÖ Label criada: ${label.name}`);
              } catch (error) {
                if (error.status === 422) {
                  // Label j√° existe, atualiza
                  try {
                    await github.rest.issues.updateLabel({
                      owner: context.repo.owner,
                      repo: context.repo.repo,
                      name: label.name,
                      color: label.color,
                      description: label.description
                    });
                    console.log(`üîÑ Label atualizada: ${label.name}`);
                  } catch (updateError) {
                    console.log(`‚ö†Ô∏è Erro ao atualizar label ${label.name}:`, updateError.message);
                  }
                } else {
                  console.log(`‚ùå Erro ao criar label ${label.name}:`, error.message);
                }
              }
            }
            
            console.log(`\n‚úÖ Processo de cria√ß√£o/atualiza√ß√£o de labels conclu√≠do!`);
